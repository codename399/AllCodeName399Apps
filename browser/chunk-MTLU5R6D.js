import{a as s}from"./chunk-JO3BUMT2.js";import{c as m}from"./chunk-RGF7OKZJ.js";import{j as u,k as d,m as i,na as g,s as p,sa as f}from"./chunk-GCSD6NER.js";var n=class extends Error{};n.prototype.name="InvalidTokenError";function k(o){return decodeURIComponent(atob(o).replace(/(.)/g,(e,t)=>{let r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}function I(o){let e=o.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return k(e)}catch{return atob(e)}}function l(o,e){if(typeof o!="string")throw new n("Invalid token specified: must be a string");e||(e={});let t=e.header===!0?0:1,r=o.split(".")[t];if(typeof r!="string")throw new n(`Invalid token specified: missing part #${t+1}`);let c;try{c=I(r)}catch(a){throw new n(`Invalid token specified: invalid base64 for part #${t+1} (${a.message})`)}try{return JSON.parse(c)}catch(a){throw new n(`Invalid token specified: invalid json for part #${t+1} (${a.message})`)}}var h=class o{#r=i(g);#e=p(null);#o=i(f);#t=i(m);get token(){return sessionStorage.getItem(s.token)}set token(e){sessionStorage.setItem(s.token,e??"")}get userId(){return sessionStorage.getItem(s.userId)}set userId(e){sessionStorage.setItem(s.userId,e??"")}get user(){return this.#e()}set user(e){this.#e.set(e)}clearToken(){sessionStorage.clear(),this.#e.set(null)}isLoggedIn(){return this.token!==""&&this.token!==null}logout(){this.clearToken(),this.#o.navigate(["/login"])}validateUser(e){return this.#r.post(this.#t.getUrl(this.#t.validateUser,!0),e).pipe(u(t=>{t?.token&&(this.userId=t.userId,this.token=t.token,console.log("decodedToken",l(this.token)))}))}getClaims(){return this.token?l(this.token):null}hasClaim(e,t){let r=this.getClaims();return r?t?r[e]&&r[e]==t:!!r[e]:!1}static \u0275fac=function(t){return new(t||o)};static \u0275prov=d({token:o,factory:o.\u0275fac,providedIn:"root"})};export{l as a,h as b};
