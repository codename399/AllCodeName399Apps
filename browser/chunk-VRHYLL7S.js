import{a as y}from"./chunk-JO3BUMT2.js";import"./chunk-BYXBJQAS.js";import{a as A}from"./chunk-OQLYQHRI.js";import{a as F,c as N}from"./chunk-RGF7OKZJ.js";import{A as b,Ba as k,C as _,E as u,Ea as V,F as f,Fa as w,G as c,Ga as R,H as i,Ha as G,I as n,Ia as O,Ja as q,Ka as $,P as S,Q as g,R as m,W as p,X as M,Y as x,Z as h,k as j,lb as B,m as s,na as I,o as P,p as v,qa as U,u as a,w as C,xa as T,ya as D,za as E}from"./chunk-GCSD6NER.js";var d=class r{#t=s(I);#e=s(N);getAll(t){return this.#t.post(this.#e.getUrl(this.#e.getAllUserProjectMappings,!0),t)}update(t){return this.#t.put(this.#e.getUrl(this.#e.updateUserProjectMappings,!0),t)}static \u0275fac=function(e){return new(e||r)};static \u0275prov=j({token:r,factory:r.\u0275fac,providedIn:"root"})};var Q=(r,t)=>t.id;function L(r,t){if(r&1&&(i(0,"option",9),p(1),n()),r&2){let e=t.$implicit;c("value",e.id),a(),x(" ",e.name," ")}}function W(r,t){if(r&1){let e=S();i(0,"mat-checkbox",14),g("change",function(l){let z=P(e).$implicit,J=m(2);return v(J.onSelectionChange(l,z))}),i(1,"label",15),p(2),n()()}if(r&2){let e=t.$implicit,o=m(2);c("id",h(e.name))("checked",o.setSelection(e.id??"")),a(),c("for",h(e.name)),a(),M(e.name)}}function X(r,t){if(r&1&&(i(0,"div",5)(1,"label",12),p(2,"Select projects:"),n(),u(3,W,3,6,"mat-checkbox",13,Q),n()),r&2){let e=m();a(3),f(e.projects)}}var H=class r{#t=s(U);#e=s(F);#r=s(d);#i=s(q);#o=s(A);users=[];projects=[];userProjectMapping;form;get userId(){return this.form.get("userId")}get projectIds(){return this.form.get("projectIds")}constructor(){this.users=this.#t.snapshot.data.usersandprojects[0]?.items,this.projects=this.#t.snapshot.data.usersandprojects[1]?.items,this.form=this.#i.group({userId:[null,[T.required]],projectIds:[[]]}),this.userId.valueChanges.subscribe(t=>{t&&(this.projectIds.reset(),this.getAll(t))})}getAll(t){this.#e.filters=[{key:y.userId,value:t,operator:"Equal"}],this.#r.getAll(this.#e).subscribe(e=>{e&&e.count>0&&(this.userProjectMapping=e.items[0],this.projectIds.setValue(this.userProjectMapping.projectIds))})}onSelectionChange(t,e){let o=this.projectIds.value??[];t.checked?o.includes(e.id??"")||this.projectIds.setValue([...o,e.id]):(o=o.filter(l=>l!=e.id),this.projectIds.setValue(o))}onSubmit(){if(this.form.valid){let t=this.form.value;this.userProjectMapping!=null&&(t.id=this.userProjectMapping.id),this.#r.update(t).subscribe(()=>{this.#o.success("Projects mapped successfully"),this.form.reset()})}else this.#o.error("Please select projects to map")}setSelection(t){return!!(this.projectIds.value??[]).includes(t)}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=C({type:r,selectors:[["app-user-project-mapping"]],decls:18,vars:3,consts:[[1,"container","vh-100","d-flex","justify-content-center","align-items-center"],[1,"card","shadow",2,"width","100%","max-width","400px"],[1,"card-body"],[1,"card-title","text-center","mb-4"],[3,"ngSubmit","formGroup"],[1,"mb-3"],["for","userId",1,"form-label"],["id","userId","formControlName","userId",1,"form-select"],["value",""],[3,"value"],[1,"d-flex","justify-content-start"],["type","submit",1,"btn","btn-primary",3,"disabled"],["for","user",1,"form-label"],["color","primary",1,"form-control",3,"id","checked"],["color","primary",1,"form-control",3,"change","id","checked"],[1,"form-label",3,"for"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),p(4," Map Projects "),n(),i(5,"form",4),g("ngSubmit",function(){return o.onSubmit()}),i(6,"div",5)(7,"label",6),p(8,"Select a user:"),n(),i(9,"select",7)(10,"option",8),p(11,"Choose..."),n(),u(12,L,2,2,"option",9,Q),n()(),b(14,X,5,0,"div",5),i(15,"div",10)(16,"button",11),p(17," Update "),n()()()()()()),e&2&&(a(5),c("formGroup",o.form),a(7),f(o.users),a(2),_(o.userId.value?14:-1),a(2),c("disabled",o.form.invalid))},dependencies:[B,k,G,O,R,D,E,V,w,$],encapsulation:2})};export{H as UserProjectMappingComponent};
